<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>RSVP</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
  <link rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/flipclock/0.7.8/flipclock.css">
  <link rel="stylesheet" href="responsive-clock.css"><!-- your mobile tweaks -->
</head>
<body>
  <h1>Khristian <br> & <br> Angelica </h1>
  <div class="card">
    <h2>Will you attend?</h2>

    <form id="rsvpForm">
      <label class="toggle">
  <input id="rsvpToggle" type="checkbox">
  <span class="track">
    <span class="txt yes">YES</span>
    <span class="txt no">NO</span>
    <span class="thumb"></span>
  </span>
</label>

      <!-- âœ“ button now INSIDE the form -->
      <button class="btn" type="submit">Submit</button>
    </form>
    <!-- <button type="submit">Submit</button> -->

    <p id="msg" class="success" style="display:none">Thanks â€” saved!</p>
    <p id="err" class="error" style="display:none">Error â€” please try again.</p>
  </div>

  <div id="countdown">
    <div class="section"><span class="number" id="d">0</span><span class="lab">Days</span></div>
    <div class="colon">:</div>

    <div class="section"><span class="number" id="h">00</span><span class="lab">Hours</span></div>
    <div class="colon">:</div>

    <div class="section"><span class="number" id="m">00</span><span class="lab">Minutes</span></div>
    <div class="colon">:</div>

    <div class="section"><span class="number" id="s">00</span><span class="lab">Seconds</span></div>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
import { getFirestore, doc, setDoc, serverTimestamp }
        from "https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js";

/* ðŸ”§ replace with your own */
const app = initializeApp({
  apiKey: "AIzaSyD5N9MzxEeVghPM_R7CDlBrlWlZMAU95T0",
  authDomain: "gerzlngelairsvp.firebaseapp.com",
  projectId: "gerzlngelairsvp",
  storageBucket: "gerzlngelairsvp.firebasestorage.app",
  messagingSenderId: "367774281093",
  appId: "1:367774281093:web:b134d69d29e370c19fe8ec",
  measurementId: "G-RQH6M218SX"
});
const db = getFirestore(app);

/* --- invite code from URL --------------------------------------- */
const code = new URLSearchParams(location.search).get('code')?.toUpperCase();
// if (!code || code.length !== 6) {
//   document.body.innerHTML = '<p style="font-size:50px">Bad invite link.</p>';
//   throw new Error('Missing code');
// }

/* --- form handler ----------------------------------------------- */
const form = document.getElementById('rsvpForm');
const msg  = document.getElementById('msg');
const err  = document.getElementById('err');

form.addEventListener('submit', async e => {
  e.preventDefault();
  err.style.display = 'none';

  const attending = new FormData(form).get('answer') === 'yes';
  const ref = doc(db, 'rsvps', code);

  try {
    await setDoc(ref, {
      attending,
      ts: serverTimestamp()
    });                        // fails if doc already exists (rules!)
    msg.style.display = 'block';
    form.style.display = 'none';
  } catch (e) {
    console.error(e);
    err.style.display = 'block';
  }
});
</script>
<script>
(() => {
  /* target: 9 Sep 2025 14:00 local browser time */
  const target = new Date('2025-09-09T14:00:00');

  const el = {
    d: document.getElementById('d'),
    h: document.getElementById('h'),
    m: document.getElementById('m'),
    s: document.getElementById('s')
  };

  function tick(){
    const now   = new Date();
    let diffSec = Math.max(0, Math.floor((target - now) / 1000));

    const d = Math.floor(diffSec / 86400); diffSec %= 86400;
    const h = Math.floor(diffSec / 3600);  diffSec %= 3600;
    const m = Math.floor(diffSec / 60);
    const s = diffSec % 60;

    el.d.textContent = d;
    el.h.textContent = h.toString().padStart(2,'0');
    el.m.textContent = m.toString().padStart(2,'0');
    el.s.textContent = s.toString().padStart(2,'0');
  }

  tick();                   // initial paint
  setInterval(tick,1000);   // update every second
})();
</script>

</body>
</html>
