<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>RSVP</title>
  <style>
    body{font-family:sans-serif;display:flex;justify-content:center;align-items:center;
         height:100vh;margin:0;background:#f3f5fa}
    .card{background:#fff;padding:2rem 3rem;border-radius:12px;
          box-shadow:0 4px 12px rgba(0,0,0,.08);text-align:center}
    button{margin-top:1rem;padding:.6rem 1.4rem;border:none;border-radius:8px;
           background:#2563eb;color:#fff;font-weight:600;cursor:pointer}
    button:disabled{opacity:.6;cursor:not-allowed}
    .success{color:#208b4c;font-weight:600;margin-top:1rem}
    .error{color:#c7332d;font-weight:600;margin-top:1rem}
  </style>
</head>
<body>
  <div class="card">
    <h1>Will you attend?</h1>

    <form id="rsvpForm">
      <label><input type="radio" name="answer" value="yes" required> Yes</label>
      <label style="margin-left:1.5rem"><input type="radio" name="answer" value="no" required> No</label>
      <button type="submit">Submit</button>
    </form>

    <p id="msg" class="success" style="display:none">Thanks â€” saved!</p>
    <p id="err" class="error" style="display:none">Error â€” please try again.</p>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
import { getFirestore, doc, setDoc, serverTimestamp }
        from "https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js";

/* ðŸ”§ replace with your own */
const app = initializeApp({
  apiKey: "AIzaSyD5N9MzxEeVghPM_R7CDlBrlWlZMAU95T0",
  authDomain: "gerzlngelairsvp.firebaseapp.com",
  projectId: "gerzlngelairsvp",
  storageBucket: "gerzlngelairsvp.firebasestorage.app",
  messagingSenderId: "367774281093",
  appId: "1:367774281093:web:b134d69d29e370c19fe8ec",
  measurementId: "G-RQH6M218SX"
});
const db = getFirestore(app);

/* --- invite code from URL --------------------------------------- */
const code = new URLSearchParams(location.search).get('code')?.toUpperCase();
if (!code || code.length !== 6) {
  document.body.innerHTML = '<p style="color:red">Bad invite link.</p>';
  throw new Error('Missing code');
}

/* --- form handler ----------------------------------------------- */
const form = document.getElementById('rsvpForm');
const msg  = document.getElementById('msg');
const err  = document.getElementById('err');

form.addEventListener('submit', async e => {
  e.preventDefault();
  err.style.display = 'none';

  const attending = new FormData(form).get('answer') === 'yes';
  const ref = doc(db, 'rsvps', code);

  try {
    await setDoc(ref, {
      attending,
      ts: serverTimestamp()
    });                        // fails if doc already exists (rules!)
    msg.style.display = 'block';
    form.style.display = 'none';
  } catch (e) {
    console.error(e);
    err.style.display = 'block';
  }
});
</script>
</body>
</html>
