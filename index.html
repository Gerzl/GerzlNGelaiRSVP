<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>RSVP</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
  <link rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/flipclock/0.7.8/flipclock.css">
  <link rel="stylesheet" href="responsive-clock.css"><!-- your mobile tweaks -->
</head>
<body>
  <!-- blue torn background bar -->
    <img class="mid-band"
        src="images/KhristianAndAngelicaBG.png"
        alt=""
        aria-hidden="true">

    <!-- white script names (front layer) -->
    <img class="names-img"
        src="images/KhristianAndAngelicaNames.png"
        alt="Khristian and Angelica">
  <div class="card">
    <h4>Invite you to their wedding</h4>
    <h2>Will you attend?</h2>

    <form id="rsvpForm">
      <label class="toggle">
        <input id="rsvpToggle" type="checkbox">
        <span class="track">
          <span class="txt yes">YES</span>
          <span class="txt no">NO</span>
          <span class="thumb"></span>
        </span>
      </label>
      <!-- âœ“ button now INSIDE the form -->
      <button class="btn" type="submit">Submit</button>
    </form>

    <p id="msg" class="success" style="display:none">Thanks â€” saved!</p>
    <p id="err" class="error" style="display:none">Error â€” please try again.</p>
  </div>

  <div id="countdown">
    <div class="section"><span class="number" id="d">0</span><span class="lab">Days</span></div>
    <div class="colon">:</div>

    <div class="section"><span class="number" id="h">00</span><span class="lab">Hours</span></div>
    <div class="colon">:</div>

    <div class="section"><span class="number" id="m">00</span><span class="lab">Minutes</span></div>
    <div class="colon">:</div>

    <div class="section"><span class="number" id="s">00</span><span class="lab">Seconds</span></div>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
import { getFirestore, doc, setDoc, serverTimestamp }
        from "https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js";

/* ðŸ”§ replace with your own */
const app = initializeApp({
  apiKey: "AIzaSyD5N9MzxEeVghPM_R7CDlBrlWlZMAU95T0",
  authDomain: "gerzlngelairsvp.firebaseapp.com",
  projectId:  "gerzlngelairsvp"
});
const db = getFirestore(app);

const code = new URLSearchParams(location.search).get('code')?.toUpperCase();
// if (!code || code.length !== 6){
//   document.body.innerHTML='<p style="font-size:40px">Bad invite link.</p>';
//   throw new Error();
// }

/* --- form handler ----------------------------------------------- */
const form  = document.getElementById('rsvpForm');
const msg   = document.getElementById('msg');
const errP  = document.getElementById('err');
const toggle= document.getElementById('rsvpToggle');


form.addEventListener('submit', async e=>{
  e.preventDefault();
  errP.style.display='none';

  const attending = toggle.checked;
  try{
    await setDoc(doc(db,'rsvps',code), {attending, ts: serverTimestamp()});
    msg.style.display='block'; form.style.display='none';
  }catch(err){
    console.error(err); errP.style.display='block';
  }
});
</script>
<script>
(() => {
  /* target: 9 Sep 2025 14:00 local browser time */
  const target = new Date('2025-09-09T14:00:00');

  const el = {
    d: document.getElementById('d'),
    h: document.getElementById('h'),
    m: document.getElementById('m'),
    s: document.getElementById('s')
  };

  function tick(){
    const now   = new Date();
    let diffSec = Math.max(0, Math.floor((target - now) / 1000));

    const d = Math.floor(diffSec / 86400); diffSec %= 86400;
    const h = Math.floor(diffSec / 3600);  diffSec %= 3600;
    const m = Math.floor(diffSec / 60);
    const s = diffSec % 60;

    el.d.textContent = d;
    el.h.textContent = h.toString().padStart(2,'0');
    el.m.textContent = m.toString().padStart(2,'0');
    el.s.textContent = s.toString().padStart(2,'0');
  }

  tick();                   // initial paint
  setInterval(tick,1000);   // update every second
})();
</script>

</body>
</html>
