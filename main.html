<!doctype html><html lang="en"><head>
<meta charset="utf-8"><title>RSVP</title>
<link rel="stylesheet" href="style.css"><!-- same card CSS as before -->
</head><body>
<div class="card">
  <h1>Please respond</h1>
  <form id="form">
    <div style="margin:1rem 0">
      <label><input type="radio" name="reply" value="yes" required> Yes</label>
      <label style="margin-left:1.5rem"><input type="radio" name="reply" value="no" required> No</label>
    </div>
    <button class="btn" type="submit">Submit</button>
  </form>
  <p id="msg" class="success">Saved â€” redirectingâ€¦</p>
</div>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
import {getFirestore, doc, getDoc, setDoc, Timestamp}
        from "https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js";

const firebaseConfig = {
      apiKey: "AIzaSyD5N9MzxEeVghPM_R7CDlBrlWlZMAU95T0",
      authDomain: "gerzlngelairsvp.firebaseapp.com",
      projectId: "gerzlngelairsvp",
      storageBucket: "gerzlngelairsvp.firebasestorage.app",
      messagingSenderId: "367774281093",
      appId: "1:367774281093:web:b134d69d29e370c19fe8ec",
      measurementId: "G-RQH6M218SX"
    };

/* ðŸ”§ your keys */ const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ----- grab code from URL ----- */
const params = new URLSearchParams(location.search);
const code   = params.get('code')?.toUpperCase();
if (!code || code.length !== 6) {
  document.querySelector('.card').innerHTML =
    "<p>Invalid or missing invite code in the link.</p>";
  throw new Error("No code");
}

/* ----- submit handler ----- */
document.getElementById('form').addEventListener('submit', async e => {
  e.preventDefault();
  const attending = new FormData(e.target).get('reply') === 'yes';
  const ref = doc(db, 'rsvps', code);
  const snap = await getDoc(ref);
  let updates = [];

  if (snap.exists()) updates = snap.data().updates || [];

  // keep last 4, then push new entry
  updates = updates.slice(-4).concat([{attending, ts: Timestamp.now()}]);

  await setDoc(ref, {updates}, {merge: true});   // create or update
  document.getElementById('msg').style.display = 'block';
  setTimeout(() => location.href = `status.html?code=${code}`, 600);
});
</script>
</body></html>
